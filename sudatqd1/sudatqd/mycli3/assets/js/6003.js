"use strict";(self["webpackChunksudatqd"]=self["webpackChunksudatqd"]||[]).push([[6003],{66003:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticStyle:{padding:"10px"}},[e("el-breadcrumb",{attrs:{separator:"/"}},[e("el-breadcrumb-item",{attrs:{to:{path:"/management/mienManagement"}}},[t._v("机构详情管理")]),e("el-breadcrumb-item",{attrs:{to:{path:"/management/addMien"}}},[t._v("新增机构")])],1)],1),e("div",{attrs:{slot:"title"},slot:"title"}),e("span",{staticStyle:{"font-family":"'楷体'","font-size":"26px"}},[t._v("新增机构")]),e("el-tabs",{staticClass:"el-tab-div",staticStyle:{"font-family":"楷体","font-size":"26px"}},[e("el-form",{ref:"addInstitution",staticStyle:{"font-size":"32px !important"},attrs:{model:t.addInstitution,rules:t.rules}},[e("el-form-item",{attrs:{label:"机构名称","label-width":t.formLabelWidth,prop:"institutionName"}},[e("el-input",{model:{value:t.addInstitution.institutionName,callback:function(e){t.$set(t.addInstitution,"institutionName",e)},expression:"addInstitution.institutionName"}})],1),e("el-form-item",{attrs:{label:"机构简介","label-width":t.formLabelWidth,prop:"institutionDescription"}},[e("el-input",{attrs:{type:"textarea",rows:5,prop:"institutionDescription"},model:{value:t.addInstitution.institutionDescription,callback:function(e){t.$set(t.addInstitution,"institutionDescription",e)},expression:"addInstitution.institutionDescription"}})],1),e("el-form-item",{staticStyle:{width:"630px"},attrs:{label:"机构图片","label-width":t.formLabelWidth}},[e("el-input",{staticStyle:{width:"388px"},attrs:{readonly:!0,placeholder:"文件名",clearable:""},model:{value:t.fileName,callback:function(e){t.fileName=e},expression:"fileName"}}),e("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{float:"right"},attrs:{action:"doUpload",limit:1,"file-list":t.fileList,"before-upload":t.beforeFileUpload}},[e("el-button",{attrs:{slot:"trigger",type:"primary"},slot:"trigger"},[t._v("上传文件"),e("i",{staticClass:"el-icon-upload el-icon--right"})]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传1M以内的文件")])],1),e("img",{staticStyle:{float:"center","margin-top":"10px"},attrs:{src:t.addInstitution.institutionPicture,width:"40%"}})],1),e("el-form-item",{attrs:{label:"相关纸张","label-width":t.formLabelWidth},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-select",{staticStyle:{width:"100%"},attrs:{props:{key:"paperId",label:"paperName"},multiple:"",placeholder:"请选择",filterable:""},nativeOn:{click:function(e){return t.getPapers.apply(null,arguments)}},model:{value:t.addInstitution.paperlist,callback:function(e){t.$set(t.addInstitution,"paperlist",e)},expression:"addInstitution.paperlist"}},t._l(t.papers,(function(t){return e("el-option",{key:t.paperId,attrs:{label:t.paperName,value:t.paperId}})})),1)]}}])}),e("el-form-item",{attrs:{label:"相关档案","label-width":t.formLabelWidth},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-select",{staticStyle:{width:"100%"},attrs:{props:{key:"archiveId",label:"archiveName"},multiple:"",placeholder:"请选择",filterable:""},nativeOn:{click:function(e){return t.getArchives.apply(null,arguments)}},model:{value:t.addInstitution.archivelist,callback:function(e){t.$set(t.addInstitution,"archivelist",e)},expression:"addInstitution.archivelist"}},t._l(t.archives,(function(t){return e("el-option",{key:t.archiveId,attrs:{label:t.archiveName,value:t.archiveId}})})),1)]}}])}),e("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"机构地点","label-width":t.formLabelWidth,prop:"institutionLocation"}},[e("el-cascader",{staticStyle:{width:"500px"},attrs:{size:"large",options:t.options1},on:{change:t.handleChange},model:{value:t.selectedOptions,callback:function(e){t.selectedOptions=e},expression:"selectedOptions"}})],1),e("el-form-item",[e("el-button",{staticStyle:{"margin-left":"-60%"},attrs:{type:"primary",size:"middle"},on:{click:t.addbaidu}},[t._v("添加详细地址信息")]),e("el-dialog",{staticStyle:{"margin-left":"10%"},attrs:{title:"地图定位",visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.close}},[e("el-form",{ref:"addInstitution",attrs:{model:t.addInstitution,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"归属地址：",prop:"building"}},[e("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.querySearchAsync,"trigger-on-focus":!1,placeholder:"请先搜索地址",clearable:""},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function({item:i}){return[e("i",{staticClass:"el-icon-search fl mgr10"}),e("div",{staticStyle:{overflow:"hidden"}},[e("div",{staticClass:"title"},[t._v(t._s(i.title))]),e("span",{staticClass:"address ellipsis"},[t._v(t._s(i.address))])])]}}]),model:{value:t.form.building,callback:function(e){t.$set(t.form,"building",e)},expression:"form.building"}})],1),e("el-form-item",{attrs:{label:"地图定位："}},[e("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"map-container"}})]),e("el-form-item",{attrs:{label:"经度："}},[e("el-input",{model:{value:t.addInstitution.longitude,callback:function(e){t.$set(t.addInstitution,"longitude",e)},expression:"addInstitution.longitude"}})],1),e("el-form-item",{attrs:{label:"维度："}},[e("el-input",{model:{value:t.addInstitution.latitude,callback:function(e){t.$set(t.addInstitution,"latitude",e)},expression:"addInstitution.latitude"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)],1)],1),e("el-form-item",{staticStyle:{"margin-left":"1px",width:"300px"},attrs:{label:"机构出现时间","label-width":t.formLabelWidth,prop:"institutionDate"},on:{change:t.chooseTimeRange}},[e("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",align:"right","picker-options":t.pickerOptions},model:{value:t.addInstitution.institutionDate,callback:function(e){t.$set(t.addInstitution,"institutionDate",e)},expression:"addInstitution.institutionDate"}})],1)],1),e("div",{staticClass:"dialog-footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addinstitution()}}},[t._v("添 加")]),e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("取 消")])],1)],1)],1)},n=[],s=(i(44114),i(53019),i(69053),i(56950)),o=(i(77819),i(60250)),l=i(30558),r=i(76678),d=i(55181),u={components:{},data(){return{rules:{institutionName:[{required:!0,message:"请输入机构名称",trigger:"blur"}],institutionDescription:[{required:!0,message:"请输入机构简介",trigger:"blur"}],process:[{required:!0,message:"请输入制作流程",trigger:"blur"}],institutionLocation:[{required:!0,message:"请输入地点",trigger:"blur"}],paperType:[{required:!0,message:"请选择纸张类型",trigger:"blur"}],fileName:[{required:!0,message:"请上传图片",trigger:"blur"}],location:[{required:!0,message:"请输入产地",trigger:"blur"}],institutionDate:[{required:!0,message:"请输入机构出现时间",trigger:"blur"}]},map:null,mk:null,initMapeq:null,dialogVisible:!1,form:{longitude:"",latitude:""},options1:s.NO,selectedOptions:[],activeName1:"1",activeName:"1",users:[],options:[],value:[],paperlist:[],list:[],loading:!1,isShow:!0,dialogVisible7:!1,adVisible7:!1,dialogVisible9:!1,adVisible9:!1,dialogVisible8:!1,adVisible8:!1,smid:"",currentPage:1,pageSizes:[2,5,10,20,30,50],pageSize:10,total:"",total1:"",total2:"",total5:"",selectName:[],archives:[],papers:[],selectName7:[],query:"",order:0,oneProjects:[],fileName:"",fileName1:"",file:null,dialogVisible5:!1,adVisible5:!1,total4:"",typeName:{0:"手工纸",1:"机械纸",2:"半手工半机械纸"},typelist1:[{paperType:0,typeName:"手工纸"},{paperType:1,typeName:"机械纸"},{paperType:2,typeName:"半手工半机械纸"}],fileList:[],fileList1:[],dialogVisible:!1,adVisible:!1,dialogVisible1:!1,adVisible1:!1,dialogVisible2:!1,adVisible2:!1,formLabelWidth:"120px",addInstitution:{longitude:"",latitude:""},firstTime:"",pickerOptions:{shortcuts:[{text:"今天",onClick(t){t.$emit("pick",new Date)}},{text:"昨天",onClick(t){const e=new Date;e.setTime(e.getTime()-864e5),t.$emit("pick",e)}},{text:"一周前",onClick(t){const e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",e)}}]}}},created(){this.chooseTimeRange(),this.getPapers(),this.getArchives()},mounted(){(0,d.A)("RiyTMxuMEPkKAoMHW47HD3XmG0pEhXNr")},methods:{close(){this.form={}},addbaidu(){this.dialogVisible=!0,this.getbaidu()},getbaidu(){this.showDialog=!0,this.initMapeq=setInterval((()=>{this.initMap()&&clearInterval(this.initMapeq)}))},initMap(){try{var t=this;this.map=new BMap.Map("map-container");var e=new BMap.Point(this.addInstitution.longitude||116.41338729034514,this.addInstitution.latitude||39.910923647957596);this.map.centerAndZoom(e,14),this.map.enableScrollWheelZoom(),this.mk=new BMap.Marker(e,{enableDragging:!0}),this.map.addOverlay(this.mk)}catch(i){return!1}return this.map.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL})),this.map.addEventListener("click",(function(e){console.log("点击了",e),t.getAddrByPoint(e.point)})),!0},getAddrByPoint(t){var e=this,i=new BMap.Geocoder;i.getLocation(t,(function(i){e.mk.setPosition(t),e.map.panTo(t),e.form.building=i.address,e.addInstitution.longitude=i.point.lng,e.addInstitution.latitude=i.point.lat,console.log(e.addInstitution.longitude),console.log(e.addInstitution.latitude)}))},querySearchAsync(t,e){var i={onSearchComplete:function(t){var i=[];if(a.getStatus()==BMAP_STATUS_SUCCESS){for(var n=0;n<t.getCurrentNumPois();n++)i.push(t.getPoi(n));e(i)}else e(i)}},a=new BMap.LocalSearch(this.map,i);a.search(t)},handleSelect(t){this.form.building=t.address+t.title,console.log(t),this.addInstitution.longitude=t.point.lng,this.addInstitution.latitude=t.point.lat,console.log("lng",t.point.lng),console.log("lat",t.point.lat),this.map.clearOverlays(),this.mk=new BMap.Marker(t.point),this.map.addOverlay(this.mk),this.map.panTo(t.point)},handleChange(t){console.log(t),console.log(t[0]),console.log(t[1]),console.log(t[2]),this.getCodeToText(null,t)},getCodeToText(t,e){if(console.log(e),null===t&&null===e)return null;null===e&&(e=t.split(","));let i="";switch(e.length){case 1:i+=s.CodeToText[e[0]];break;case 2:i+=s.CodeToText[e[0]]+"/"+s.CodeToText[e[1]];break;case 3:i+=s.CodeToText[e[0]]+"/"+s.CodeToText[e[1]]+"/"+s.CodeToText[e[2]];break;default:break}return console.log(i),this.addInstitution.institutionLocation=i,console.log(this.addInstitution.institutionLocation),i},chooseTimeRange(t){this.firstTime=t,console.log(this.firstTime)},getArchives(){(0,r.WM)().then((t=>{this.archives=t.data,console.log(this.archives)}))},filterTag(t,e,i){const a=i["property"];return e[a]===t},_filterChange(){this.totalSize=this.$refs.table.projectList.length,console.log(this.totalSize)},sendWangEditor(t){this.oneProjects.hyperlinks=t},reload(){this.isShow=!1,this.$nextTick((()=>{this.isShow=!0,this.$refs.table.bodyWrapper.scrollTop=0}))},back(){this.$router.push("/management/mienManagement")},selectList1(){Projects().then((t=>{this.selectName=t.data}))},resetQuery(){this.query="",this.currentPage=1,this.pageSize=10,this.typefilter="",this.coursefilter="",this.getProjects()},indexMethods(t){return(this.currentPage-1)*this.pageSize+t+1},beforeFileUpload(t){const e=t.size/1024/1024<10;return e?(this.file=t,this.fileName=t.name,!1):(this.$message.error("上传的文件大小不能超过 10MB!"),!1)},addinstitution(){if(console.log(this.addInstitution),""==this.addInstitution.paperName)return this.$message({type:"warning",message:"机构名称为空，请填写！"}),!1;this.$refs.addInstitution.validate((t=>{if(!t)return console.log("error submit!!"),!1;this.$confirm("您确定要添加该机构吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=new FormData;t.append("file",this.file),t.append("institutionName",this.addInstitution.institutionName),t.append("institutionLocation",this.addInstitution.institutionLocation),t.append("longitude",this.addInstitution.longitude),t.append("latitude",this.addInstitution.latitude),t.append("paperIds",this.addInstitution.paperlist),t.append("archiveIds",this.addInstitution.archivelist),t.append("institutionDate",this.addInstitution.institutionDate),t.append("institutionDescription",this.addInstitution.institutionDescription),t.append("institutionPicture",this.addInstitution.institutionPicture),(0,l.SH)(t).then((t=>{"操作成功"==t.message?(this.$router.push("/management/mienManagement"),this.$message({type:"success",message:"添加成功！"}),this.adVisible=!1,this.$router.push("/management/mienManagement")):500==t.code?(this.$message({type:"error",message:"机构名重复！"}),this.adVisible=!1):this.$message({type:"error",message:t.message})}))}))}))},indexMethods4(t){return(this.currentPage4-1)*this.pageSize4+t+1},getPapers(){(0,o.L2)().then((t=>{this.papers=t.data,console.log(this.papers)}))}},filters:{formatData(t){return moment(t).format("YYYY-MM-DD")}}},p=u,c=i(81656),m=(0,c.A)(p,a,n,!1,null,"20bbe812",null),h=m.exports},55181:function(t,e,i){function a(t){return new Promise((function(e,i){if("undefined"!==typeof window.BMap)return e(window.BMap),!0;window.onBMapCallback=function(){e(window.BMap)};const a=document.createElement("script");a.type="text/javascript",a.src="https://api.map.baidu.com/api?v=3.0&ak="+t+"&callback=onBMapCallback",a.onerror=i,document.head.appendChild(a)}))}i.d(e,{A:function(){return a}})},53019:function(t,e,i){var a=i(85471);a["default"].filter("filterAmount",(function(t,e){return e||(e=20),t&&t.length>e&&(t=t.substring(0,e)+"..."),t}))}}]);