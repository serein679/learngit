"use strict";(self["webpackChunksudatqd"]=self["webpackChunksudatqd"]||[]).push([[8490],{18490:function(t,e,i){i.r(e),i.d(e,{default:function(){return b}});var n=function(){var t=this,e=t._self._c;return e("div",{attrs:{slot:"title"},slot:"title"},[e("div",{staticStyle:{padding:"10px"}},[e("el-breadcrumb",{attrs:{separator:"/"}},[e("el-breadcrumb-item",{attrs:{to:{path:"/management/mienManagement"}}},[t._v("机构详情管理")]),e("el-breadcrumb-item",{attrs:{to:{path:"/management/editorMien"}}},[t._v("编辑机构")])],1)],1),e("span",{staticStyle:{"font-family":"'STKaiti'","font-size":"26px"}},[t._v("编辑机构")]),e("el-tabs",{staticClass:"el-tab-div",staticStyle:{"font-family":"STKaiti","font-size":"26px"}},[e("el-form",{ref:"oneInstitution",staticStyle:{"font-size":"32px !important"},attrs:{model:t.oneInstitution}},[e("el-form-item",{attrs:{label:"机构名称","label-width":t.formLabelWidth,prop:"institutionName"}},[e("el-input",{model:{value:t.oneInstitution.institutionItem.institutionName,callback:function(e){t.$set(t.oneInstitution.institutionItem,"institutionName",e)},expression:"oneInstitution.institutionItem.institutionName"}})],1),e("el-form-item",{attrs:{label:"机构简介","label-width":t.formLabelWidth,prop:"institutionDescription"}},[e("el-input",{attrs:{type:"textarea",rows:5,prop:"institutionDescription"},model:{value:t.oneInstitution.institutionItem.institutionDescription,callback:function(e){t.$set(t.oneInstitution.institutionItem,"institutionDescription",e)},expression:"oneInstitution.institutionItem.institutionDescription"}})],1),e("el-form-item",{attrs:{label:"相关档案","label-width":t.formLabelWidth},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-select",{staticStyle:{width:"100%"},attrs:{props:{key:"archiveId",label:"archiveName"},multiple:"",placeholder:"请选择",filterable:""},nativeOn:{click:function(e){return t.getArchives.apply(null,arguments)}},model:{value:t.oneInstitution.archiveList,callback:function(e){t.$set(t.oneInstitution,"archiveList",e)},expression:"oneInstitution.archiveList"}},t._l(t.archives,(function(t){return e("el-option",{key:t.archiveId,attrs:{label:t.archiveName,value:t.archiveId}})})),1)]}}])}),e("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"机构地点","label-width":t.formLabelWidth,prop:"institutionLocation"}},[e("el-cascader",{staticStyle:{width:"500px"},attrs:{size:"large",options:t.options1},on:{change:t.handleChange},model:{value:t.selectedOptions,callback:function(e){t.selectedOptions=e},expression:"selectedOptions"}})],1),e("el-form-item",[e("el-button",{staticStyle:{"margin-left":"-60%"},attrs:{type:"primary",size:"middle"},on:{click:t.addbaidu}},[t._v("添加详细地址信息")]),e("el-dialog",{staticStyle:{"margin-left":"10%"},attrs:{title:"地图定位",visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.close}},[e("el-form",{ref:"form",attrs:{model:t.oneInstitution,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"归属地址：",prop:"building"}},[e("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.querySearchAsync,"trigger-on-focus":!1,placeholder:"请先搜索地址",clearable:""},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function({item:i}){return[e("i",{staticClass:"el-icon-search fl mgr10"}),e("div",{staticStyle:{overflow:"hidden"}},[e("div",{staticClass:"title"},[t._v(t._s(i.title))]),e("span",{staticClass:"address ellipsis"},[t._v(t._s(i.address))])])]}}]),model:{value:t.form.building,callback:function(e){t.$set(t.form,"building",e)},expression:"form.building"}})],1),e("el-form-item",{attrs:{label:"地图定位："}},[e("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"map-container"}})]),e("el-form-item",{attrs:{label:"经度："}},[e("el-input",{model:{value:t.oneInstitution.institutionItem.longitude,callback:function(e){t.$set(t.oneInstitution.institutionItem,"longitude",e)},expression:"oneInstitution.institutionItem.longitude"}})],1),e("el-form-item",{attrs:{label:"维度："}},[e("el-input",{model:{value:t.oneInstitution.institutionItem.latitude,callback:function(e){t.$set(t.oneInstitution.institutionItem,"latitude",e)},expression:"oneInstitution.institutionItem.latitude"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)],1)],1),e("el-form-item",{staticStyle:{"margin-left":"1px",width:"300px"},attrs:{label:"机构出现时间","label-width":t.formLabelWidth,prop:"institutionDate"}},[e("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",align:"right","picker-options":t.pickerOptions},model:{value:t.oneInstitution.institutionItem.institutionDate,callback:function(e){t.$set(t.oneInstitution.institutionItem,"institutionDate",e)},expression:"oneInstitution.institutionItem.institutionDate"}})],1)],1),e("div",{staticClass:"dialog-footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.changeProject()}}},[t._v("修 改")]),e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("取 消")])],1)],1)],1)},o=[],s=(i(44114),i(53019),i(56950)),a=i(30558),l=i(60250),r=i(76678),u=i(30966),c=i.n(u),d=i(55181);let p=new(c().AMapManager);var m={components:{},data(){let t=this;return{addMerFrom:{merchant:"",areaCode:["440000","440300","440305"],area:"广东省深圳市南山区",address:"",lng:"113.923552",lat:"22.528499"},center:{},keyword:"",input3:"",mapFrom:{amapManager:p,zoom:15,center:[113.923552,22.528499],events:{click:e=>{let i=[e.lnglat.lng,e.lnglat.lat];t.mapFrom.center=i,t.addMerFrom.lng=e.lnglat.lng,t.addMerFrom.lat=e.lnglat.lat,t.getAdress(i)}}},rules:{institutionName:[{required:!0,message:"请输入机构名称",trigger:"blur"}],institutionLocation:[{required:!0,message:"请输入机构地点",trigger:"blur"}],process:[{required:!0,message:"请输入制作流程",trigger:"blur"}],site:[{required:!0,message:"请输入地点",trigger:"blur"}],paperType:[{required:!0,message:"请选择纸张类型",trigger:"blur"}],fileName:[{required:!0,message:"请上传图片",trigger:"blur"}],institutionDescription:[{required:!0,message:"请输入机构描述",trigger:"blur"}],institutionDate:[{required:!0,message:"请输入机构出现时间",trigger:"blur"}]},options1:s.NO,selectedOptions:[],activeName1:"1",activeName:"1",users:[],paperId:"",options:[],value:[],list:[],loading:!1,isShow:!0,dialogVisible7:!1,adVisible7:!1,dialogVisible9:!1,adVisible9:!1,dialogVisible8:!1,adVisible8:!1,teachers:[],smid:"",oneInstitution:[],teachers:[],currentPage:1,pageSizes:[2,5,10,20,30,50],pageSize:10,total:"",total1:"",total2:"",total5:"",selectName:[],selectName7:[],query:"",order:0,oneProjects:[],editor:"",fileName:"",fileName1:"",file:null,dialogVisible5:!1,adVisible5:!1,total4:"",typeName:{0:"手工纸",1:"机械纸",2:"半手工半机械纸"},fileList:[],fileList1:[],headers:{},dialogVisible:!1,adVisible:!1,dialogVisible1:!1,adVisible1:!1,dialogVisible2:!1,adVisible2:!1,formLabelWidth:"120px",papers:[],archives:[],map:null,mk:null,initMapeq:null,dialogVisible:!1,form:{longitude:"",latitude:""},typelist1:[{paperType:0,typeName:"手工纸"},{paperType:1,typeName:"机械纸"},{paperType:2,typeName:"半手工半机械纸"}],pickerOptions:{shortcuts:[{text:"今天",onClick(t){t.$emit("pick",new Date)}},{text:"昨天",onClick(t){const e=new Date;e.setTime(e.getTime()-864e5),t.$emit("pick",e)}},{text:"一周前",onClick(t){const e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",e)}}]},center:{lng:0,lat:0},zoom:10}},created(){this.gettingData(),this.getPapers(),this.getArchives(),this.getOneIn(this.institutionId)},watch:{$route:"gettingData"},mounted(){(0,d.A)("RiyTMxuMEPkKAoMHW47HD3XmG0pEhXNr")},methods:{close(){this.form={}},addbaidu(){this.dialogVisible=!0,this.getbaidu()},getbaidu(){this.showDialog=!0,this.initMapeq=setInterval((()=>{this.initMap()&&clearInterval(this.initMapeq)}))},initMap(){try{var t=this;this.map=new BMap.Map("map-container");var e=new BMap.Point(this.oneInstitution.longitude||116.41338729034514,this.oneInstitution.latitude||39.910923647957596);this.map.centerAndZoom(e,14),this.map.enableScrollWheelZoom(),this.mk=new BMap.Marker(e,{enableDragging:!0}),this.map.addOverlay(this.mk)}catch(i){return!1}return this.map.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL})),this.map.addEventListener("click",(function(e){console.log("点击了",e),t.getAddrByPoint(e.point)})),!0},getAddrByPoint(t){var e=this,i=new BMap.Geocoder;i.getLocation(t,(function(i){e.mk.setPosition(t),e.map.panTo(t),e.form.building=i.address,e.oneInstitution.longitude=i.point.lng,e.oneInstitution.latitude=i.point.lat,console.log(e.oneInstitution.longitude),console.log(e.oneInstitution.latitude)}))},querySearchAsync(t,e){var i={onSearchComplete:function(t){var i=[];if(n.getStatus()==BMAP_STATUS_SUCCESS){for(var o=0;o<t.getCurrentNumPois();o++)i.push(t.getPoi(o));e(i)}else e(i)}},n=new BMap.LocalSearch(this.map,i);n.search(t)},handleSelect(t){this.form.building=t.address+t.title,console.log(t),this.oneInstitution.longitude=t.point.lng,this.oneInstitution.latitude=t.point.lat,console.log("lng",t.point.lng),console.log("lat",t.point.lat),this.map.clearOverlays(),this.mk=new BMap.Marker(t.point),this.map.addOverlay(this.mk),this.map.panTo(t.point)},getTeacherIntro(){TeacherIntro().then((t=>{this.teachers=t.data}))},handleChange(t){this.getCodeToText(null,t)},getCodeToText(t,e){if(console.log(e),null===t&&null===e)return null;null===e&&(e=t.split(","));let i="";switch(e.length){case 1:i+=s.CodeToText[e[0]];break;case 2:i+=s.CodeToText[e[0]]+"/"+s.CodeToText[e[1]];break;case 3:i+=s.CodeToText[e[0]]+"/"+s.CodeToText[e[1]]+"/"+s.CodeToText[e[2]];break;default:break}return console.log(i),this.oneInstitution.institutionLocation=i,console.log(this.oneInstitution.institutionLocation),i},filterTag(t,e,i){const n=i["property"];return e[n]===t},getArchives(){(0,r.WM)().then((t=>{this.archives=t.data,console.log(this.archives)}))},gettingData(){var t=JSON.parse(this.$Base64.decode(this.$route.query.info));this.institutionId=t},_filterChange(){this.totalSize=this.$refs.table.projectList.length,console.log(this.totalSize)},sendWangEditor(t){this.oneProjects.hyperlinks=t},indexMethods(t){return(this.currentPage-1)*this.pageSize+t+1},beforeFileUpload(t){const e=t.size/1024/1024<1;return e?(this.file=t,this.fileName=t.name,!1):(this.$message.error("上传的文件大小不能超过 1MB!"),!1)},getPapers(){(0,l.L2)().then((t=>{this.papers=t.data,console.log(this.papers)}))},getOneIn(t){(0,a.Wp)(t).then((t=>{this.oneInstitution=t.data,this.paperList1=this.oneInstitution.paperList1,this.fileName=this.oneInstitution.institutionPicture,this.selectedOptions=s.TextToCode[this.oneInstitution.institutionItem.institutionLocation.split("/")[0]][this.oneInstitution.institutionItem.institutionLocation.split("/")[1]][this.oneInstitution.institutionItem.institutionLocation.split("/")[2]].code,console.log(this.oneInstitution)}))},changeProject(){if(console.log(this.oneInstitution),""==this.oneInstitution.institutionName)return this.$message({type:"warning",message:"机构名称为空，请填写！"}),!1;this.$refs.oneInstitution.validate((t=>{if(!t)return console.log("error submit!!"),!1;this.$confirm("您确定要修改该机构吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=new FormData;t.append("file",this.file),t.append("institutionId",this.oneInstitution.institutionId),t.append("institutionName",this.oneInstitution.institutionName),t.append("institutionLocation",this.oneInstitution.institutionLocation),t.append("longitude",this.oneInstitution.longitude),t.append("latitude",this.oneInstitution.latitude),t.append("paperIds",this.oneInstitution.paperList1),t.append("archiveIds",this.oneInstitution.archiveList1),t.append("institutionDescription",this.oneInstitution.institutionDescription),t.append("institutionDate",new Date(this.oneInstitution.institutionDate)),t.append("institutionPicture",this.oneInstitution.institutionPicture),(0,a.xA)(t).then((t=>{"操作成功"==t.message?(this.$router.push("/management/mienManagement"),this.$message({type:"success",message:"修改成功！"}),this.dialogVisible=!1):500==t.code?(this.$message({type:"error",message:"机构名重复！"}),this.adVisible=!1):this.$message({type:"error",message:t.message})}))}))}))},back(){this.$router.push("/management/mienManagement")},indexMethods4(t){return(this.currentPage4-1)*this.pageSize4+t+1}},filters:{formatData(t){return moment(t).format("YYYY-MM-DD")}}},h=m,g=i(81656),f=(0,g.A)(h,n,o,!1,null,"5cd80e00",null),b=f.exports},55181:function(t,e,i){function n(t){return new Promise((function(e,i){if("undefined"!==typeof window.BMap)return e(window.BMap),!0;window.onBMapCallback=function(){e(window.BMap)};const n=document.createElement("script");n.type="text/javascript",n.src="https://api.map.baidu.com/api?v=3.0&ak="+t+"&callback=onBMapCallback",n.onerror=i,document.head.appendChild(n)}))}i.d(e,{A:function(){return n}})},53019:function(t,e,i){var n=i(85471);n["default"].filter("filterAmount",(function(t,e){return e||(e=20),t&&t.length>e&&(t=t.substring(0,e)+"..."),t}))}}]);